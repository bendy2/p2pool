<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tari-Cpu TPOOL分享池</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <!-- Disqus 配置 -->
    <script>
        var disqus_config = function () {
            this.page.url = 'https://www.tpool.cc';  // 你的网站URL
            this.page.identifier = 'tpool-pro';  // 唯一标识符
            this.page.title = 'Tari Pool Announcements';
            this.language = 'zh';  // 设置语言为中文
        };
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Tari-Cpu</a>   <a href="https://t.me/+FShj1uLvag0zYTRl" target="_blank">TG交流群</a>
            <div class="d-flex">
                <form class="d-flex" action="/u/" method="get">
                    <input class="form-control me-20" type="search" name="username" placeholder="输入用户名(TARI钱包地址)" required>
                    <button class="btn btn-outline-light" type="submit">查询</button>
                </form>
            </div>
        </div>
    </nav>


        <!-- Disqus 公告板 -->
        <div class="container-fluid mt-4">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-megaphone"></i> 矿池公告</h5>

                </div>
                <div class="card-body">
                    <div class="alert alert-info">                        
                        5-19   关于昨天 事件的补偿计算方案已经完成.共1809297个XTM和24.079954个XMT已经分发至所有用户..
                        并已经完成所有帐户余额发放.
                    </div>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="row mb-4">
            <!-- 矿池算力走势图 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">矿池算力走势</h5>
                        <div style="height: 300px;">
                            <div id="hashrateChart" style="width: 100%; height: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- XMR区块时间间隔图 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">XMR区块时间间隔</h5>
                        <div style="height: 300px;">
                            <div id="xmrBlockIntervalChart" style="width: 100%; height: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- TARI区块时间间隔图 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">TARI区块时间间隔</h5>
                        <div style="height: 300px;">
                            <div id="tariBlockIntervalChart" style="width: 100%; height: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 矿池状态 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        矿池状态
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-2">
                                <div class="status-item">
                                    <h5>总算力</h5>
                                    <p id="total-hashrate">0 H/s</p>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="status-item">
                                    <h5>在线矿工</h5>
                                    <p id="active-miners">0</p>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="status-item">
                                    <h5>XMR总奖励</h5>
                                    <p id="xmr-balance">0.000000 XMR</p>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="status-item">
                                    <h5>TARI总奖励</h5>
                                    <p id="tari-balance">0.00 XTM</p>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="status-item">
                                    <h5>XMR已支付</h5>
                                    <p id="xmr-paid">0.000000 XMR</p>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="status-item">
                                    <h5>TARI已支付</h5>
                                    <p id="tari-paid">0.00 XTM</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 在线矿工和区块信息 -->
        <div class="row mb-4">
            <!-- 在线矿工 -->
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-header">
                        在线矿工
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">                        
                            说明: 算力只是参考数据(如果矿工不是使用xmrig-proxy连接的矿池,算力会虚高),矿池实际根据SHARE计数来分配每个BLOCK的收益
                        </div>
                        <div class="table-responsive" >
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>用户名</th>
                                        <th>算力</th>
                                        <th>XMR-share</th>
                                        <th>TARI-share</th>
                                    </tr>
                                </thead>
                                <tbody id="online-miners-list">
                                    <!-- 数据将通过 JavaScript 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 区块信息 -->
            <div class="col-md-9">
                <div class="card h-100">
                    <div class="card-header">
                        区块信息
                    </div>
                    <div class="card-body" >
                        <div class="table-responsive" style="height: 1000px; overflow-y: auto;">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>时间</th>
                                        <th>高度</th>
                                        <th>区块哈希</th>
                                        <th>类型</th>
                                        <th>奖励</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody id="blocks-list">
                                    <!-- 数据将通过 JavaScript 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 矿池介绍 -->
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <div class="card">
                    <div class="card-header">
                        矿池介绍
                    </div>
                    <div class="card-body">
                        <div class="pool-intro">
                            <h4>关于我们</h4>
                            <p>这是一个基于P2Pool的Tari-CPU挖矿矿池，支持XMR和TARI双挖。</p>
                            <p>矿池地址: tari.tpool.pro:33333</p>
                            
                            <h4>矿池特点</h4>
                            <ul>
                                <li>支持XMR和TARI双挖</li>
                                <li>低费率，高收益.双倍收益.爽歪歪</li>
                                <li>实时收益计算.只要有SHARE提交(软件上能看见) 就可以有收益! </li>
                                <li>门罗币起付点 0.01XMR 无锁定期.TARI币爆块网络锁定18小时,起付点100XTM</li>
                                <li>其于安全理由.每天中午12点和凌晨12点 统一支付</li>
                                <li>在页面左上角输入TARI地址或者 自定义的-u用户名 查看信息</li>
                            </ul>
                            
                            <h4>挖矿配置</h4>
                            <div class="config-example">
                                <pre><code>./xmrig -o tari.tpool.pro:33333 -u  XMR_WALLER_ADDRESS:TARI_WALLER_ADDRESS</code><br>请严格按这格式作为-u参数作为用户名..不要添加其他参数. <BR>尽快使用xmrig-proxy来将同一局域网内多台机器集中-中转一下...如果多机器直连矿池..矿池记录的算力会虚高.</pre>
                                <pre>代理连接方法:  ./xmrig-proxy -b 0.0.0.0:12345  -o tari.tpool.pro:33333 -u  XMR_WALLER_ADDRESS:TARI_WALLER_ADDRES 代理 连接后..所有机器就连接代理 即可.../xmrig -o 192.168.0.2:12345   (假设PROXY的内网IP是192.168.0.2 ) </pre>
                            </div>
                            
                            <h4>费率说明</h4>
                            <p>矿池费率为8%，用于维护矿池运营和开发。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script>
    // 初始化算力走势图
    function initHashrateChart() {
        const chartDom = document.getElementById('hashrateChart');
        const myChart = echarts.init(chartDom);
        
        const option = {
            title: {
                text: '矿池算力走势',
                left: 'center',
                top: 0,
                textStyle: {
                    fontSize: 14
                }
            },
            grid: {
                top: 30,
                right: 20,
                bottom: 30,
                left: 50,
                containLabel: true
            },
            tooltip: {
                trigger: 'axis',
                formatter: function(params) {
                    const data = params[0];
                    const date = new Date(data.value[0]);
                    const time = date.toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });
                    return `${time}<br/>${(data.value[1]/1000/1000).toFixed(2)} MH/s`;
                }
            },
            xAxis: {
                type: 'time',
                axisLabel: {
                    formatter: function(value) {
                        const date = new Date(value);
                        return date.toLocaleTimeString('zh-CN', {
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: false
                        });
                    },
                    interval: 'auto',
                    rotate: 45
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        type: 'dashed'
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: '算力',
                nameTextStyle: {
                    padding: [0, 0, 0, 40]
                },
                axisLabel: {
                    formatter: function(value) {
                        return (value/1000/1000).toFixed(0) + 'M';
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        type: 'dashed'
                    }
                }
            },
            series: [{
                name: '矿池算力',
                type: 'line',
                smooth: true,
                showSymbol: false,
                areaStyle: {
                    opacity: 0.1,
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: 'rgb(54, 162, 235)' },
                        { offset: 1, color: 'rgba(54, 162, 235, 0.1)' }
                    ])
                },
                lineStyle: {
                    width: 2,
                    color: 'rgb(54, 162, 235)'
                },
                data: []
            }]
        };
        
        myChart.setOption(option);
        return myChart;
    }

    // 更新算力数据
    function updateHashrateData() {
        // 使用已有的blocks数据
        const blocksList = document.getElementById('blocks-list');
        if (!blocksList) return;

        const chart = echarts.getInstanceByDom(document.getElementById('hashrateChart'));
        if (!chart) return;

        const rows = blocksList.getElementsByTagName('tr');
        if (rows.length < 2) return;

        const formattedData = [];
        for (let i = 1; i < rows.length; i++) {
            const currentRow = rows[i];
            const prevRow = rows[i-1];
            
            const currentTime = new Date(currentRow.cells[0].textContent).getTime();
            const prevTime = new Date(prevRow.cells[0].textContent).getTime();
            const timeDiff = (currentTime - prevTime) / 1000; // 转换为秒

            if (timeDiff > 0) {
                // 从状态列获取难度信息
                const currentStatus = currentRow.cells[5].textContent;
                const difficulty = parseFloat(currentStatus.split(' ')[0]) || 0;
                
                // 计算算力 (difficulty / time_diff)
                const hashrate = (difficulty / timeDiff) * 1000; // 转换为H/s
                formattedData.push([currentTime, hashrate]);
            }
        }

        chart.setOption({
            series: [{
                data: formattedData
            }]
        });
    }

    // 初始化XMR区块时间间隔图表
    function initXmrBlockIntervalChart() {
        const chartDom = document.getElementById('xmrBlockIntervalChart');
        const myChart = echarts.init(chartDom);
        
        const option = {
            title: {
                text: 'XMR区块时间间隔',
                left: 'center',
                top: 0,
                textStyle: {
                    fontSize: 14
                }
            },
            tooltip: {
                trigger: 'axis',
                formatter: function(params) {
                    const data = params[0];
                    return `时间: ${data.value[0]}<br/>间隔: ${data.value[1]}分钟`;
                }
            },
            xAxis: {
                type: 'time',
                axisLabel: {
                    formatter: function(value) {
                        const date = new Date(value);
                        return date.toLocaleString('zh-CN', {
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: '时间间隔(分钟)',
                nameTextStyle: {
                    padding: [0, 0, 0, 40]
                }
            },
            series: [{
                name: 'XMR区块间隔',
                type: 'bar',
                barWidth: '60%',
                itemStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: '#83bff6' },
                        { offset: 0.5, color: '#188df0' },
                        { offset: 1, color: '#188df0' }
                    ])
                },
                emphasis: {
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#2378f7' },
                            { offset: 0.7, color: '#2378f7' },
                            { offset: 1, color: '#83bff6' }
                        ])
                    }
                },
                data: []
            }]
        };
        
        myChart.setOption(option);
        return myChart;
    }

    // 初始化TARI区块时间间隔图表
    function initTariBlockIntervalChart() {
        const chartDom = document.getElementById('tariBlockIntervalChart');
        const myChart = echarts.init(chartDom);
        
        const option = {
            title: {
                text: 'TARI区块时间间隔',
                left: 'center',
                top: 0,
                textStyle: {
                    fontSize: 14
                }
            },
            tooltip: {
                trigger: 'axis',
                formatter: function(params) {
                    const data = params[0];
                    return `时间: ${data.value[0]}<br/>间隔: ${data.value[1]}分钟`;
                }
            },
            xAxis: {
                type: 'time',
                axisLabel: {
                    formatter: function(value) {
                        const date = new Date(value);
                        return date.toLocaleString('zh-CN', {
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: '时间间隔(分钟)',
                nameTextStyle: {
                    padding: [0, 0, 0, 40]
                }
            },
            series: [{
                name: 'TARI区块间隔',
                type: 'bar',
                barWidth: '60%',
                itemStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: '#91cc75' },
                        { offset: 0.5, color: '#5470c6' },
                        { offset: 1, color: '#5470c6' }
                    ])
                },
                emphasis: {
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#5470c6' },
                            { offset: 0.7, color: '#5470c6' },
                            { offset: 1, color: '#91cc75' }
                        ])
                    }
                },
                data: []
            }]
        };
        
        myChart.setOption(option);
        return myChart;
    }
    
    // 更新区块时间间隔数据
    function updateBlockIntervalData() {
        const blocksList = document.getElementById('blocks-list');
        if (!blocksList) return;

        const xmrChart = echarts.getInstanceByDom(document.getElementById('xmrBlockIntervalChart'));
        const tariChart = echarts.getInstanceByDom(document.getElementById('tariBlockIntervalChart'));
        if (!xmrChart || !tariChart) return;

        const rows = blocksList.getElementsByTagName('tr');
        if (rows.length < 2) return;

        const xmrData = [];
        const tariData = [];

        for (let i = 1; i < rows.length; i++) {
            const currentRow = rows[i];
            const prevRow = rows[i-1];
            
            const currentTime = new Date(currentRow.cells[0].textContent).getTime();
            const prevTime = new Date(prevRow.cells[0].textContent).getTime();
            const timeDiff = (currentTime - prevTime) / (1000 * 60); // 转换为分钟

            // 根据区块类型分类
            const blockType = currentRow.cells[3].textContent.trim();
            const intervalData = [currentTime, timeDiff];

            if (blockType === 'XMR') {
                xmrData.push(intervalData);
            } else if (blockType === 'TARI') {
                tariData.push(intervalData);
            }
        }

        // 更新XMR区块时间间隔图表
        xmrChart.setOption({
            series: [{
                data: xmrData
            }]
        });

        // 更新TARI区块时间间隔图表
        tariChart.setOption({
            series: [{
                data: tariData
            }]
        });
    }

    // 初始化图表
    const hashrateChart = initHashrateChart();
    const xmrBlockIntervalChart = initXmrBlockIntervalChart();
    const tariBlockIntervalChart = initTariBlockIntervalChart();

    // 定期更新数据
    setInterval(updateBlocks, 30000);  // 每30秒更新一次区块数据
    setInterval(updateHashrateData, 30000);  // 每30秒更新一次算力图表
    setInterval(updatePoolStatus, 30000);  // 每30秒更新一次矿池状态

    // 页面加载时立即更新一次
    updateBlocks();
    updateHashrateData();
    updatePoolStatus();

    // 监听窗口大小变化，调整图表大小
    window.addEventListener('resize', function() {
        const chart = echarts.getInstanceByDom(document.getElementById('hashrateChart'));
        const xmrChart = echarts.getInstanceByDom(document.getElementById('xmrBlockIntervalChart'));
        const tariChart = echarts.getInstanceByDom(document.getElementById('tariBlockIntervalChart'));
        if (chart) chart.resize();
        if (xmrChart) xmrChart.resize();
        if (tariChart) tariChart.resize();
    });

    </script>
</body>
</html> 